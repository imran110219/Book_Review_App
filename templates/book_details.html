{% extends "base.html" %}
{% load ratings %}
{% block content %}

  <div class="col-lg-4">
    <h1>Book Details</h1>
    <img src='{{ book.book_image.url }}' class='img-responsive'/>
    <h2>{{ book.book_name }}</h2>
    {% ratings book %}
    <h3>Author: </h3>
    {% for obj in book.authors.all %}
      <h4>{{ obj.get_name }}</h4>
    {% endfor %}
    <p>{{ book.book_description }}</p>

  </div>

  <br/>


  <div class="col-lg-8">


    <div class="card my-4">
      <h5 class="card-header">Leave a Review:</h5>
      <div class="card-body">
        {% if request.user.is_authenticated %}
          <form action="." method="post">
            {% csrf_token %}
            {{ review_form.review_description }}
            <button type="submit" class="btn btn-primary">Submit</button>
          </form>
        {% else %}
          <p>You must login to give review</p>
        {% endif %}

      </div>
    </div>


    {% for review in reviews %}
      <div class="review">
        {#        <p class="info">#}
        {#          {% if  review.user.first_name and review.user.last_name %}#}
        {#            <h4>{{ review.user.first_name }} {{ review.user.last_name }}({{ forloop.counter }})</h4>#}
        {#          {% else %}#}
        {#            <h4>{{ review.user }}({{ forloop.counter }})</h4>#}
        {#          {% endif %}#}
        {#        </p>#}
        {#        {{ review.review_description|linebreaks }}#}
        <div>
          <img src="http://placekitten.com/45/45" class="img-responsive commenterImage"/>
        </div>
        <div class="reviewText">
          {% if  review.user.first_name and review.user.last_name %}
            <p><strong>{{ review.user.first_name }} {{ review.user.last_name }}({{ forloop.counter }})</strong> <span class="date sub-text">on {{ review.timestamp }}</span></p>
          {% else %}
            <p><strong>{{ review.user }}({{ forloop.counter }})</strong> <span class="date sub-text">on {{ review.timestamp }}</span></p>
          {% endif %}
          <p class="">{{ review.review_description }}</p>
          <a href="{% url "edit-review" id=review.id %}" class="badge badge-primary">Edit</a>
          <a href="{% url "delete" pk=review.id %}" class="badge badge-danger">Delete</a>
        </div>

      </div>

      <div class="comments">

        <div class="card my-4">
          <h5 class="card-header">Leave a Comment:</h5>
          <div class="card-body">
            {% if request.user.is_authenticated %}
              <form action="." method="post" class="form-horizontal" role="form">
                <div class="form-group">
                  <div class="col-sm-11">
                    <input class="form-control" name="comments" type="text" placeholder="Your comments"/>
                  </div>
                  {% csrf_token %}
                  <input type="hidden" name="review" value={{ review.id }}>
                  <button type="submit" class="btn btn-primary">Add</button>
                </div>
              </form>
            {% else %}
              <p>You must login to give comment</p>
            {% endif %}
          </div>
        </div>

        <ul class="commentList">
          {% for comment in comments %}
            {% if comment.review == review %}
              <li>
                <div>
                  <img src="http://placekitten.com/45/45" class="img-responsive commenterImage"/>
                </div>
                <div class="commentText">
                  <p class="">{{ comment.comments }}</p>
                  {% if  review.user.first_name and review.user.last_name %}
                    <span class="date sub-text">on {{ comment.timestamp }} by {{ comment.user.first_name }} {{ comment.user.last_name }}({{ forloop.counter }})</span>
                  {% else %}
                    <span class="date sub-text">on {{ comment.timestamp }} by {{ comment.user }}({{ forloop.counter }})</span>
                  {% endif %}
                </div>
              </li>
            {% endif %}
          {% endfor %}
        </ul>
        {% empty %}
        <p>There are no comments yet.</p>
      </div>

    {% endfor %}

  </div>

{% endblock content %}