{% extends "base.html" %}
{% block content %}

  <div class="col-lg-3">
    <h1>Book Details</h1>
    <img src='{{ book.book_image.url }}' class='img-responsive'/>
    <h2>{{ book.book_name }}</h2>
    <h3>Author: </h3>
    {% for obj in book.authors.all %}
      <h4>{{ obj.get_name }}</h4>
    {% endfor %}
    <p>{{ book.book_description }}</p>
  </div>

  <br/>

  <div class="col-lg-9">
    <h1>Review</h1>


    <div class="card my-4">
      <h5 class="card-header">Leave a Review:</h5>
      <div class="card-body">
        {% if request.user.is_authenticated %}
          <form action="." method="post">
            {% csrf_token %}
            {{ review_form.review_description }}
            <button type="submit" class="btn btn-primary">Submit</button>
          </form>
        {% else %}
          <p>You must login to give review</p>
        {% endif %}

      </div>
    </div>

    {% for review in reviews %}
      <div class="review">
        <p class="info">
          {% if  review.user.first_name and review.user.last_name %}
            <h4>{{ review.user.first_name }} {{ review.user.last_name }}({{ forloop.counter }})</h4>
          {% else %}
            <h4>{{ review.user }}({{ forloop.counter }})</h4>
          {% endif %}
        </p>
        {{ review.review_description|linebreaks }}
        <div class="comments">
          <form action="." method="post">
            {% csrf_token %}
            <input type="hidden" name="review" value={{ review.id }} >
            {{ comment_form.comments }}
            <button type="submit" class="btn btn-primary">Submit</button>
          </form>
        </div>
        {% for comment in comments %}
          {% if comment.review == review %}
            <div class="comments">
              <p class="info">
                {% if  comment.user.first_name and comment.user.last_name %}
                  <h5>{{ comment.user.first_name }} {{ comment.user.last_name }}({{ forloop.counter }})</h5>
                {% else %}
                  <h5>{{ comment.user }}({{ forloop.counter }})</h5>
                {% endif %}
              </p>
              {{ comment.comments|linebreaks }}
            </div>
          {% endif %}
        {% endfor %}
      </div>


    {% empty %}
      <p>There are no comments yet.</p>
    {% endfor %}

  </div>

{% endblock content %}